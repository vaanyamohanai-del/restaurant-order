<!DOCTYPE html>
<html>
<head>
  <title>Cart</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial; max-width: 600px; margin: 20px auto; padding: 20px; }
    h2 { text-align: center; color: #333; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #3498db; color: white; }
    button { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .qty-btn { background: #95a5a6; color: white; margin: 0 2px; }
    .remove-btn { background: #e74c3c; color: white; }
    .place-order { background: #27ae60; color: white; padding: 15px 35px; font-size: 16px; margin: 10px; }
    .back-btn { background: #3498db; color: white; padding: 15px 35px; font-size: 16px; margin: 10px; }
  </style>
</head>
<body>
  <h2>Table <span id="tableNo"></span> - Your Cart</h2>
  
  <table>
    <thead><tr><th>Item</th><th>Price</th><th>Qty</th><th>Total</th><th></th></tr></thead>
    <tbody id="cartItems"></tbody>
  </table>
  
  <h3 id="grandTotal" style="text-align: right; margin: 20px 0; font-size: 24px;">Grand Total: â‚¹0</h3>
  
  <!-- HIDDEN restaurant number -->
  <input type="hidden" id="restaurantPhone" value="+919876543210">
  
  <div style="text-align: center;">
    <button class="place-order" onclick="placeOrder()">ðŸš€ Send Order to Kitchen</button>
    <br><button class="back-btn" onclick="goBack()">Back to Menu</button>
  </div>

  <script>
    // FIXED - Put these at the VERY TOP
    const menu = {1: {name:"Burger", price:120}, 2:{name:"Pizza", price:250}};
    let tableNo = new URLSearchParams(window.location.search).get('table') || 1;
    let verifiedPhone = new URLSearchParams(window.location.search).get('phone') || '';
    
    // FIXED - Set table number FIRST
    document.getElementById("tableNo").innerText = tableNo + (verifiedPhone ? ` (${verifiedPhone})` : '');
    
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    
    function renderCart() {
      let tbody = document.getElementById("cartItems");
      tbody.innerHTML = ""; 
      let total = 0;
      let orderLines = [];
      
      cart.forEach((item, i) => {
        let menuItem = menu[item.id]; 
        let itemTotal = menuItem.price * item.qty;
        total += itemTotal;
        orderLines.push(`${menuItem.name} x${item.qty} = â‚¹${itemTotal}`);
        
        tbody.innerHTML += `<tr>
          <td>${menuItem.name}</td>
          <td>â‚¹${menuItem.price}</td>
          <td><button class="qty-btn" onclick="changeQty(${i},-1)">-</button>${item.qty}<button class="qty-btn" onclick="changeQty(${i},1)">+</button></td>
          <td>â‚¹${itemTotal}</td>
          <td><button class="remove-btn" onclick="removeItem(${i})">X</button></td>
        </tr>`;
      });
      
      document.getElementById("grandTotal").innerText = `Grand Total: â‚¹${total}`;
      window.orderSummary = orderLines.join('\n');
      window.grandTotal = total;
    }
    
    function changeQty(i, change) {
      cart[i].qty += change; 
      if (cart[i].qty <= 0) cart.splice(i,1);
      localStorage.setItem("cart", JSON.stringify(cart)); 
      renderCart();
    }
    
    function removeItem(i) { 
      cart.splice(i,1); 
      localStorage.setItem("cart", JSON.stringify(cart)); 
      renderCart(); 
    }
    
    function placeOrder() { 
      if (cart.length === 0) return alert("Cart is empty!");
      
      const phone = document.getElementById("restaurantPhone").value;
      const now = new Date().toLocaleString('en-IN', {timeZone: 'Asia/Kolkata'});
      const message = `ðŸ”” *NEW ORDER*

ðŸ“ Table No: ${tableNo}
â° Order Time: ${now}

ðŸ” *ORDER ITEMS:*
${window.orderSummary}

ðŸ’° *TOTAL: â‚¹${window.grandTotal}*

âœ… Please prepare ASAP!`;

      const cleanPhone = phone.replace(/[^0-9]/g, '');
      const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
      
      window.open(whatsappUrl, '_blank');
      
      localStorage.removeItem("cart");
      alert("âœ… Order sent to Kitchen!");
      setTimeout(() => window.location.href = "index.html", 1000);
    }
    
    function goBack() { window.location.href="index.html"; }
    
    // FIXED - Call renderCart() at the END
    renderCart();
  </script>
</body>
</html>
