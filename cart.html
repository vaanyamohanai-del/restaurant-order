<!DOCTYPE html>
<html>
<head>
  <title>Your Cart</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial; max-width: 600px; margin: 20px auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .container { background: white; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); overflow: hidden; }
    h2 { text-align: center; padding: 25px; background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; margin: 0; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 20px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: linear-gradient(45deg, #3498db, #2980b9); color: white; }
    button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 2px; transition: all 0.3s; }
    .qty-btn { background: #95a5a6; color: white; font-size: 16px; }
    .remove-btn { background: #e74c3c; color: white; }
    .place-order { background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; padding: 20px 50px; font-size: 18px; display: block; margin: 30px auto; border-radius: 12px; }
    .back-btn { background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 20px 50px; font-size: 18px; display: block; margin: 15px auto 0; border-radius: 12px; }
    #grandTotal { text-align: right; padding: 25px; font-size: 28px; font-weight: bold; color: #27ae60; background: #f8f9fa; margin: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ›’ Table <span id="tableNo"></span> - Your Cart</h2>
    
    <table>
      <thead><tr><th>Item</th><th>Price</th><th>Qty</th><th>Total</th><th></th></tr></thead>
      <tbody id="cartItems"></tbody>
    </table>
    
    <h3 id="grandTotal">Grand Total: â‚¹0</h3>
    
    <!-- HIDDEN - Restaurant receives orders here -->
    <input type="hidden" id="restaurantPhone" value="+919342179559">
    
    <div style="text-align: center; padding: 30px;">
      <button class="place-order" onclick="placeOrder()">ðŸš€ Send Order to Kitchen</button>
      <br><button class="back-btn" onclick="goBack()">ðŸ”™ Back to Menu</button>
    </div>
  </div>

  <script>
    const menu = {1: {name:"ðŸ” Burger", price:120}, 2:{name:"ðŸ• Pizza", price:250}};
    let tableNo = new URLSearchParams(window.location.search).get('table') || 1;
    let verifiedPhone = new URLSearchParams(window.location.search).get('phone') || '';
    document.getElementById("tableNo").innerText = tableNo + (verifiedPhone ? ` (${verifiedPhone})` : '');
    
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    
    function renderCart() {
      let tbody = document.getElementById("cartItems");
      tbody.innerHTML = ""; 
      let total = 0;
      let orderLines = [];
      
      cart.forEach((item, i) => {
        let menuItem = menu[item.id]; 
        let itemTotal = menuItem.price * item.qty;
        total += itemTotal;
        orderLines.push(`${menuItem.name} x${item.qty} = â‚¹${itemTotal}`);
        
        tbody.innerHTML += `<tr>
          <td>${menuItem.name}</td>
          <td>â‚¹${menuItem.price}</td>
          <td><button class="qty-btn" onclick="changeQty(${i},-1)">-</button>${item.qty}<button class="qty-btn" onclick="changeQty(${i},1)">+</button></td>
          <td>â‚¹${itemTotal}</td>
          <td><button class="remove-btn" onclick="removeItem(${i})">âœ•</button></td>
        </tr>`;
      });
      
      document.getElementById("grandTotal").innerText = `Grand Total: â‚¹${total}`;
      window.orderSummary = orderLines.join('\n');
      window.grandTotal = total;
    }
    
    function changeQty(i, change) {
      cart[i].qty += change; 
      if (cart[i].qty <= 0) cart.splice(i,1);
      localStorage.setItem("cart", JSON.stringify(cart)); 
      renderCart();
    }
    
    function removeItem(i) { 
      cart.splice(i,1); 
      localStorage.setItem("cart", JSON.stringify(cart)); 
      renderCart(); 
    }
    
    function placeOrder() { 
      if (cart.length === 0) return alert("âŒ Cart is empty!");
      
      const phone = document.getElementById("restaurantPhone").value;
      const now = new Date().toLocaleString('en-IN', {timeZone: 'Asia/Kolkata'});
      const message = `ðŸ”” *NEW RESTAURANT ORDER*

ðŸ“ *Table:* ${tableNo}
ðŸ“± *Customer:* ${verifiedPhone}
â° *Time:* ${now}

ðŸ½ï¸ *ORDER DETAILS:*
${window.orderSummary}

ðŸ’° *GRAND TOTAL:* â‚¹${window.grandTotal}

âœ… *Status:* AWAITING PREPARATION`;

      const cleanPhone = phone.replace(/[^0-9]/g, '');
      const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
      
      window.open(whatsappUrl, '_blank');
      localStorage.removeItem("cart");
      alert("âœ… Order sent to Kitchen successfully!");
      setTimeout(() => window.location.href = "index.html", 1500);
    }
    
    function goBack() { window.location.href="index.html"; }
    
    renderCart();
  </script>
</body>
</html>
